# 🔧 Environment Variables Setup

This document explains how to set up environment variables for the ShopMefy application.

## 📁 Environment Files Structure

```
AI4Devs-finalproject/
├── backend/
│   └── .env                  ← Backend environment (created during deployment)
├── frontend/
│   └── .env                  ← Frontend environment (created during deployment)
└── terraform/
    ├── terraform.tfvars      ← Terraform variables (optional)
    └── outputs.tf            ← Infrastructure outputs
```

## 🚀 Environment Configuration

### **Development (Local)**
Environment files are created manually for local development.

### **Production (EC2)**
Environment files are **automatically created** during GitHub Actions deployment.

## 🔑 Backend Environment Variables

### **Production (.env on EC2)**
```bash
NODE_ENV=production
PORT=8080
DATABASE_URL=postgresql://shopmefy:password@rds-host:5432/shopmefy
OPENROUTER_API_KEY=your_openrouter_api_key
JWT_SECRET=your_jwt_secret
```

### **Development (.env local)**
```bash
NODE_ENV=development
PORT=3001
DATABASE_URL=postgresql://shopmefy:password@localhost:5432/shopmefy
OPENROUTER_API_KEY=your_openrouter_api_key
JWT_SECRET=your_jwt_secret_dev
```

## 🎨 Frontend Environment Variables

### **Production (.env on EC2)**
```bash
VITE_API_URL=http://EC2_HOST/api
```

### **Development (.env local)**
```bash
VITE_API_URL=http://localhost:3001
```

## 🔒 GitHub Secrets Configuration

### **Required for Infrastructure (Terraform)**
```
AWS_ACCESS_KEY_ID          # AWS access key for Terraform
AWS_SECRET_ACCESS_KEY      # AWS secret key for Terraform
```

### **Required for Application**
```
OPENROUTER_API_KEY         # AI service API key
JWT_SECRET                 # Authentication secret
```

### **Auto-Generated by Terraform**
```
EC2_HOST                   # Public IP of EC2 instance
SSH_PRIVATE_KEY            # Private SSH key for EC2 access
DATABASE_URL               # Complete PostgreSQL connection string
S3_BUCKET_NAME             # S3 bucket for file uploads
```

## 📋 GitHub Secrets Setup

### **1. Navigate to Repository Settings**
```
Repository → Settings → Secrets and variables → Actions → Environment secrets
```

### **2. Add Required Secrets**
| Secret Name | Description | Example |
|-------------|-------------|---------|
| `AWS_ACCESS_KEY_ID` | AWS access key | `AKIA...` |
| `AWS_SECRET_ACCESS_KEY` | AWS secret key | `wJalr...` |
| `OPENROUTER_API_KEY` | OpenRouter API key | `sk-or-...` |
| `JWT_SECRET` | JWT authentication secret | `super-secret-key-256-bits` |

### **3. Auto-Generated Secrets**
These are automatically created by Terraform and deployment workflows:
- `EC2_HOST` - Set by Terraform output
- `SSH_PRIVATE_KEY` - Set by Terraform output  
- `DATABASE_URL` - Set by Terraform output
- `S3_BUCKET_NAME` - Set by Terraform output

## 🏗️ Infrastructure Environment

### **Terraform Variables (terraform.tfvars)**
```hcl
aws_region = "us-east-1"
db_password = ""  # Leave empty for auto-generation
```

### **Terraform Outputs**
```bash
# Get infrastructure information
terraform output web_public_ip      # EC2 public IP
terraform output ssh_command        # SSH connection command
terraform output database_url       # Database connection string
terraform output s3_bucket_name     # S3 bucket name
```

## 🔄 Deployment Flow

### **1. Infrastructure Creation**
```bash
cd terraform
terraform apply
# Outputs: EC2_HOST, SSH_PRIVATE_KEY, DATABASE_URL, S3_BUCKET_NAME
```

### **2. GitHub Secrets Update**
Manually add the Terraform outputs to GitHub Secrets.

### **3. Application Deployment**
```bash
# GitHub Actions automatically:
# 1. Creates backend .env with DATABASE_URL, OPENROUTER_API_KEY, JWT_SECRET
# 2. Creates frontend .env with VITE_API_URL
# 3. Deploys application to EC2
```

## 🎯 Environment Differences

### **Local Development**
- **Database**: Local PostgreSQL on port 5432
- **Backend**: http://localhost:3001
- **Frontend**: http://localhost:3000
- **Files**: Manual .env creation

### **Production (EC2)**
- **Database**: AWS RDS PostgreSQL
- **Backend**: http://EC2_HOST:8080 (via Nginx)
- **Frontend**: http://EC2_HOST:3000 (via Nginx)
- **Files**: Auto-created during deployment

## 🔒 Security Best Practices

### **Environment Files**
- ✅ **Never commit .env files** to git
- ✅ **Use different secrets** for dev/prod
- ✅ **Rotate secrets regularly**
- ✅ **Use strong JWT secrets** (256-bit minimum)

### **GitHub Secrets**
- ✅ **Use environment-specific secrets**
- ✅ **Limit access** to necessary workflows
- ✅ **Monitor secret usage** in Actions logs
- ✅ **Rotate AWS keys** periodically

### **Database Security**
- ✅ **RDS in private subnets** only
- ✅ **Security group restrictions**
- ✅ **Strong auto-generated passwords**
- ✅ **Encrypted storage**

## 🛠️ Troubleshooting

### **Common Issues**

#### **Missing Environment Variables**
```bash
# Check if .env exists on EC2
ssh -i key.pem ubuntu@EC2_HOST
ls -la ~/AI4Devs-finalproject/backend/.env
ls -la ~/AI4Devs-finalproject/frontend/.env
```

#### **Database Connection Issues**
```bash
# Test database connection
psql "postgresql://shopmefy:password@rds-host:5432/shopmefy"
```

#### **GitHub Secrets Issues**
```bash
# Check if secrets are properly set in GitHub
# Repository → Settings → Secrets and variables → Actions
```

### **Environment Validation**

#### **Backend Environment Check**
```bash
# On EC2 server
cd ~/AI4Devs-finalproject/backend
cat .env
npm run start  # Should start without errors
```

#### **Frontend Environment Check**
```bash
# On EC2 server
cd ~/AI4Devs-finalproject/frontend
cat .env
npm run build  # Should build without errors
```

## 📚 Related Documentation

- **Infrastructure**: `prompts/docs/infra-workflow-prompt.md`
- **Deployment**: `prompts/docs/deploy-workflow.md`
- **Database**: `prompts/docs/database-schema.md`
- **Security**: `prompts/docs/owasp.md` 